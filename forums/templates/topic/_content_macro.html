{% import 'base/link.html' as link %}


{% macro votes(topic) -%}
<div class="votes">
    {% if topic.vote and topic.vote > 0 -%}
    {{ vote_a('up',topic.vote) }}
    {% else %}
    {{ vote_a('up') }}
    {%- endif %}
    {% if topic.vote and topic.vote < 0 %}
    {{ vote_a('down',topic.vote) }}
    {% else %}
    {{ vote_a('down') }}
    {%- endif %}
</div>
{%- endmacro %}

{% macro vote_a(vo,count=None) -%}
{% if count -%}
<a id="topic-{{ vo }}-vote" class="vote" href="javascript:void(0)" style="text-decoration:none;">
    <i class="icon-chevron-{{ vo }}">{{ count }}</i>
</a>
{% else %}
<a id="topic-{{ vo }}-vote" class="vote" href="javascript:void(0)" style="text-decoration:none;">
    <i class="icon-chevron-{{ vo }}"></i>
</a>
{%- endif %}
{%- endmacro %}

{% macro title(topic) -%}
{% set author = topic.author %}
<div class="panel-heading media">
    <div class="media-body">
        <h3 class="media-heading" style="font-size:20px;"><b>{{ topic.title }}</b></h3>
        <small style="color:#999">
            {{ votes(topic) }}
            {% for tag in topic.tags %}
            {{ link.tag(tag) }}
            {% endfor %}
            <span style="margin-left:10px;">
                {% set last_reply = topic.replies.first() %}
                {{ topic.author.username }}
                {{ _('published at %(time)s',time = topic.created_at | timesince ) }}
                {% if last_reply %}
                Â· {{ _('The last reply published by %(author)s at %(time)s',author=link.user(last_reply.author.username),time=last_reply.created_at | timesince)}}
                {% endif %}
            </span>
        </small>
    </div>
    <div class="media-right">
        <a href="{{ url_for('user.user',username=topic.author.username)}}">
            <img class="media-object img-circle" src="{{ url_for('avatar',text=author.username)}}" style="width:56px;height:56px">
        </a>
    </div>
</div>
{%- endmacro %}

{% macro body(topic) -%}
<div class="panel-body topic-content">
    {% if topic.is_markdown %}
    {{ topic.content | markdown }}
    {% else %}
    {{ topic.content | safe_clean }}
    {% endif %}
</div>
{%- endmacro %}
